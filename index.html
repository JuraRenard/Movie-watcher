<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Movie Tracker</title>
<link rel="stylesheet" href="style.css"/>
</head>
<body>
<h1>My Movie Tracker</h1>

<header>
    <input id="search" type="text" placeholder="Search in any list…" oninput="render()"/>
    <input id="movieIdInput" type="text" placeholder="Movie ID (ttXXXXXXX)" />
    <select id="listSelect">
        <option value="watching">Watching Now</option>
        <option value="plan">Plan to Watch</option>
        <option value="completed">Completed</option>
    </select>
    <button onclick="addMovie()">Add</button>
</header>

<div class="lists">
    <div class="list">
        <h2><input data-key="watchingName" value="Watching Now" onblur="saveName(this)"/></h2>
        <div id="watching"></div>
    </div>
    <div class="list">
        <h2><input data-key="planName" value="Plan to Watch" onblur="saveName(this)"/></h2>
        <div id="plan"></div>
    </div>
    <div class="list">
        <h2><input data-key="completedName" value="Completed" onblur="saveName(this)"/></h2>
        <div id="completed"></div>
    </div>
</div>

<script>
/* ---------- helpers ---------- */
const storage = {
    get(k, d=[]){ return JSON.parse(localStorage.getItem(k) || JSON.stringify(d)) },
    set(k, v){ localStorage.setItem(k, JSON.stringify(v)) }
};
const lists = ['watching','plan','completed'];
let data = {};
lists.forEach(k=>data[k]=storage.get(k));

/* ---------- render ---------- */
function render(){
    const term = document.getElementById('search').value.toLowerCase();
    lists.forEach(list=>{
        const cont = document.getElementById(list);
        cont.innerHTML='';
        data[list]
            .filter(id=>id.toLowerCase().includes(term))
            .forEach(id=>{
                const div=document.createElement('div');
                div.className='movie';
                div.innerHTML=`
                    <span onclick="goWatch('${id}')">${id}</span>
                    <div>
                        <select onchange="moveMovie('${id}','${list}',this.value)">
                            <option value="">Move to</option>
                            ${lists.filter(l=>l!==list).map(l=>`<option value="${l}">${localStorage.getItem(l+'Name')||l}</option>`).join('')}
                        </select>
                        <button onclick="removeMovie('${id}','${list}')">✕</button>
                    </div>`;
                cont.appendChild(div);
            });
    });
}
render();

/* ---------- actions ---------- */
function addMovie(){
    const id=document.getElementById('movieIdInput').value.trim();
    const list=document.getElementById('listSelect').value;
    if(!id || data[list].includes(id)) return;
    data[list].push(id);
    storage.set(list,data[list]);
    document.getElementById('movieIdInput').value='';
    render();
}
function removeMovie(id,list){
    data[list]=data[list].filter(x=>x!==id);
    storage.set(list,data[list]);
    render();
}
function moveMovie(id,from,to){
    if(!to) return;
    data[from]=data[from].filter(x=>x!==id);
    if(!data[to].includes(id)) data[to].push(id);
    lists.forEach(l=>storage.set(l,data[l]));
    render();
}
function goWatch(id){
    location.href='watch.html?id='+encodeURIComponent(id);
}
function saveName(inp){
    const key=inp.dataset.key;
    localStorage.setItem(key,inp.value);
    render(); // refresh select options
}
/* init list names */
lists.forEach(l=>{
    const key=l+'Name';
    const val=localStorage.getItem(key)||(l==='watching'?'Watching Now':l==='plan'?'Plan to Watch':'Completed');
    document.querySelector(`input[data-key="${key}"]`).value=val;
});
</script>
</body>
</html>
